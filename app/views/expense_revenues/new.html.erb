<header class="bg-white shadow-sm border-b border-gray-200">
  <div class="flex items-center justify-between px-6 py-4">
    <div class="flex items-center space-x-4">
      <a href="<%= expense_revenues_path %>" class="text-gray-500 hover:text-gray-700">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </a>
      <div class="flex items-center space-x-3">
        <h1 class="text-2xl font-bold text-gray-900">New Expense/Revenue Entry</h1>
      </div>
    </div>
  </div>
</header>

<main class="flex-1 overflow-y-auto">
  <div class="p-6">
    <%= form_with model: @expense_revenue, local: true, class: "space-y-8" do |form| %>
      <!-- Expense Details -->
      <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-semibold text-gray-900">Expense Details</h2>
        </div>
        <div class="p-6 space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <%= form.label :expense_date, "Expense Date *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.date_field :expense_date, required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :receipt_date, "Receipt Date *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.date_field :receipt_date, required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :vendor_name, "Vendor Name *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :vendor_name, required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :category, "Category *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.select :category, options_for_select([
                ['Meals/Refreshments', 'meals_refreshments'],
                ['Accommodation', 'accommodation'],
                ['Equipment', 'equipment'],
                ['Office Consumables', 'office_consumables'],
                ['Transportation', 'transportation'],
                ['PMS/Repair', 'pms_repair'],
                ['Tax', 'tax'],
                ['Payroll', 'payroll'],
                ['HMO', 'hmo'],
                ['Charity', 'charity'],
                ['Company Activity', 'company_activity'],
                ['Contribution', 'contribution']
              ], @expense_revenue.category), { prompt: "Select Category" }, { required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" } %>
            </div>
            <div>
              <%= form.label :amount, "Amount (‚Ç±) *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.number_field :amount, step: 0.01, required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :sales_order_number, "Sales Order Number *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :sales_order_number, required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
          </div>
          
          <div>
            <%= form.label :purpose, "Purpose *", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :purpose, required: true, rows: 3, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
          </div>
          
          <div>
            <%= form.label :vendor_address, "Vendor Address *", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_area :vendor_address, required: true, rows: 3, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
          </div>
        </div>
      </div>

      <!-- System Information -->
      <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-semibold text-gray-900">System Information</h2>
        </div>
        <div class="p-6 space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <%= form.label :po_number, "PO Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :po_number, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :rfp_number, "RFP Number", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :rfp_number, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :bank_reference, "Bank Reference", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :bank_reference, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :client_name, "Client Name *", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.text_field :client_name, required: true, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :quantity, "Quantity", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.number_field :quantity, step: 0.01, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
            <div>
              <%= form.label :unit_price, "Unit Price (‚Ç±)", class: "block text-sm font-medium text-gray-700 mb-2" %>
              <%= form.number_field :unit_price, step: 0.01, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
            </div>
          </div>
          
          <div>
            <%= form.label :vendor_tin, "Vendor TIN", class: "block text-sm font-medium text-gray-700 mb-2" %>
            <%= form.text_field :vendor_tin, class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
          </div>
        </div>
      </div>

      <!-- Receipts -->
      <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-semibold text-gray-900">Receipts</h2>
        </div>
        <div class="p-6">
          <%= form.label :receipts, "Receipts", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <p class="text-sm text-gray-500 mb-2">Upload receipt images or PDFs (PDF, JPG, PNG)</p>
          <%= form.file_field :receipts, multiple: true, accept: ".pdf,.jpg,.jpeg,.png", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
          <div id="receipt-preview" class="mt-2 space-y-2"></div>
        </div>
      </div>

      <!-- Supporting Documents -->
      <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-semibold text-gray-900">Supporting Documents</h2>
        </div>
        <div class="p-6">
          <%= form.label :supporting_documents, "Supporting Documents", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <p class="text-sm text-gray-500 mb-2">Upload supporting documents (PDF, DOC, DOCX, JPG, PNG)</p>
          <%= form.file_field :supporting_documents, multiple: true, accept: ".pdf,.doc,.docx,.jpg,.jpeg,.png", class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" %>
          <div id="document-preview" class="mt-2 space-y-2"></div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex justify-end space-x-4">
        <%= link_to "Cancel", expense_revenues_path, class: "px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200" %>
        <%= form.submit "Create Entry", class: "px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-200" %>
      </div>
    <% end %>
  </div>
</main>

<script>
  // File preview functionality
  document.addEventListener('DOMContentLoaded', function() {
    const receiptInput = document.querySelector('input[name="expense_revenue[receipts][]"]');
    const documentInput = document.querySelector('input[name="expense_revenue[supporting_documents][]"]');
    const receiptPreview = document.getElementById('receipt-preview');
    const documentPreview = document.getElementById('document-preview');

    if (receiptInput) {
      receiptInput.addEventListener('change', function(e) {
        handleFilePreview(e, receiptPreview);
      });
    }

    if (documentInput) {
      documentInput.addEventListener('change', function(e) {
        handleFilePreview(e, documentPreview);
      });
    }
  });

  function handleFilePreview(event, previewContainer) {
    previewContainer.innerHTML = '';
    
    Array.from(event.target.files).forEach((file, index) => {
      const fileItem = document.createElement('div');
      fileItem.className = 'flex items-center justify-between p-2 bg-gray-50 rounded border';
      
      const fileInfo = document.createElement('div');
      fileInfo.className = 'flex items-center space-x-2';
      
      const fileIcon = document.createElement('div');
      fileIcon.className = 'w-4 h-4 text-gray-500';
      fileIcon.innerHTML = getFileIcon(file.type);
      
      const fileName = document.createElement('span');
      fileName.className = 'text-sm text-gray-700';
      fileName.textContent = file.name;
      
      const fileSize = document.createElement('span');
      fileSize.className = 'text-xs text-gray-500';
      fileSize.textContent = `(${formatFileSize(file.size)})`;
      
      fileInfo.appendChild(fileIcon);
      fileInfo.appendChild(fileName);
      fileInfo.appendChild(fileSize);
      
      fileItem.appendChild(fileInfo);
      previewContainer.appendChild(fileItem);
    });
  }

  function getFileIcon(fileType) {
    if (fileType.includes('pdf')) {
      return 'üìÑ';
    } else if (fileType.includes('word') || fileType.includes('document')) {
      return 'üìù';
    } else if (fileType.includes('image')) {
      return 'üñºÔ∏è';
    } else {
      return 'üìé';
    }
  }

  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }
</script>

