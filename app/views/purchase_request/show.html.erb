<!-- Main Content -->
    <!-- Top Navigation -->
    <header class="bg-white shadow-sm border-b border-gray-200">
      <div class="flex items-center justify-between px-6 py-4">
        <div class="flex items-center space-x-4">
          <button id="mobile-sidebar-toggle" class="text-gray-500 hover:text-gray-700 lg:hidden">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          <div class="flex items-center space-x-3">
            <a href="<%= purchase_request_path %>" class="text-gray-500 hover:text-gray-700">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </a>
            <h1 class="text-2xl font-bold text-gray-900">Purchase Request #<%= @purchase_request.id %></h1>
          </div>
        </div>
        
        <div class="flex items-center space-x-4">
          <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full
            <%= case @purchase_request.priority_level
                when 'urgent' then 'bg-red-100 text-red-800'
                when 'high' then 'bg-orange-100 text-orange-800'
                when 'medium' then 'bg-yellow-100 text-yellow-800'
                when 'low' then 'bg-green-100 text-green-800'
                else 'bg-gray-100 text-gray-800'
                end %>">
            <%= @purchase_request.priority_level&.humanize || 'Not Set' %>
          </span>
        </div>
      </div>
    </header>

    <!-- Content -->
    <div class="p-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Basic Information -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Basic Information
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Request Date</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.request_date.strftime("%B %d, %Y") %></p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Requester</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.requester_user&.email || 'Unknown' %></p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Priority Level</label>
                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                  <%= case @purchase_request.priority_level
                      when 'urgent' then 'bg-red-100 text-red-800'
                      when 'high' then 'bg-orange-100 text-orange-800'
                      when 'medium' then 'bg-yellow-100 text-yellow-800'
                      when 'low' then 'bg-green-100 text-green-800'
                      else 'bg-gray-100 text-gray-800'
                      end %>">
                  <%= @purchase_request.priority_level&.humanize || 'Not Set' %>
                </span>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Created At</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.created_at.strftime("%B %d, %Y at %I:%M %p") %></p>
              </div>
            </div>
          </div>

          <!-- Items Details -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
              </svg>
              Items (<%= @purchase_request.items.count %>)
            </h3>
            
            <% if @purchase_request.items.any? %>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cost</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <% @purchase_request.items.each do |item| %>
                      <tr>
                        <td class="px-6 py-4 text-sm text-gray-900"><%= item.description %></td>
                        <td class="px-6 py-4 text-sm text-gray-900"><%= item.quantity %></td>
                        <td class="px-6 py-4 text-sm text-gray-900">$<%= number_with_precision(item.cost, precision: 2) %></td>
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">$<%= number_with_precision(item.quantity * item.cost, precision: 2) %></td>
                      </tr>
                    <% end %>
                  </tbody>
                  <tfoot class="bg-gray-50">
                    <tr>
                      <td colspan="3" class="px-6 py-4 text-sm font-medium text-gray-900 text-right">Total:</td>
                      <td class="px-6 py-4 text-sm font-bold text-gray-900">$<%= number_with_precision(@purchase_request.items.sum { |item| item.quantity * item.cost }, precision: 2) %></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            <% else %>
              <p class="text-sm text-gray-500">No items found for this purchase request.</p>
            <% end %>
          </div>

          <!-- Vendor Information -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
              </svg>
              Vendor Information
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Vendor Name</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.vendor_name || 'Not provided' %></p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Sales Order Number</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.sales_order_number || 'Not provided' %></p>
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Vendor Address</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.vendor_address || 'Not provided' %></p>
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Bank Details</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.bank_details || 'Not provided' %></p>
              </div>
            </div>
          </div>

          <!-- Additional Information -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Additional Information
            </h3>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Reason for Purchase</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.reason_for_purchase || 'Not provided' %></p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.client_name || 'Not provided' %></p>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Additional Notes</label>
                <p class="text-sm text-gray-900"><%= @purchase_request.additional_notes || 'Not provided' %></p>
              </div>
            </div>
          </div>

          <!-- Attachments -->
          <% if @purchase_request.attachments.any? %>
            <div class="bg-white rounded-lg shadow-sm p-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <svg class="w-5 h-5 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                </svg>
                Attachments (<%= @purchase_request.attachments.count %>)
              </h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <% @purchase_request.attachments.each do |attachment| %>
                  <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                    <div class="flex items-center space-x-3">
                      <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-900 truncate"><%= attachment.filename %></p>
                        <p class="text-xs text-gray-500"><%= number_to_human_size(attachment.byte_size) %></p>
                      </div>
                    </div>
                    <div class="mt-3">
                      <%= link_to "Download", rails_blob_path(attachment, disposition: "attachment"), class: "text-sm text-red-600 hover:text-red-900" %>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Status Card -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Status</h3>
            
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-gray-700">Budget Approval</span>
                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                  <%= @purchase_request.budget_approve? ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800' %>">
                  <%= @purchase_request.budget_approve? ? 'Approved' : 'Pending' %>
                </span>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-gray-700">Procurement Review</span>
                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full
                  <%= @purchase_request.procurement_approve? ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800' %>">
                  <%= @purchase_request.procurement_approve? ? 'Approved' : 'Pending' %>
                </span>
              </div>
            </div>
          </div>

          <!-- Actions Card -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Actions</h3>
            
            <div class="space-y-3">
              <% unless @purchase_request.budget_approve? %>
                <button class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors duration-200">
                  Approve Budget
                </button>
              <% end %>
              
              <% unless @purchase_request.procurement_approve? %>
                <button class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors duration-200">
                  Approve Procurement
                </button>
              <% end %>
              
              <% if @purchase_request.budget_approve? && @purchase_request.procurement_approve? %>
                <a href="<%= create_purchase_order_path(@purchase_request) %>" class="w-full bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors duration-200 inline-block text-center">
                  Create Purchase Order
                </a>
              <% end %>
            </div>
          </div>

          <!-- Summary Card -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Summary</h3>
            
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Total Items:</span>
                <span class="text-sm font-medium text-gray-900"><%= @purchase_request.items.count %></span>
              </div>
              
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Total Cost:</span>
                <span class="text-sm font-medium text-gray-900">$<%= number_with_precision(@purchase_request.items.sum { |item| item.quantity * item.cost }, precision: 2) %></span>
              </div>
              
              <div class="flex justify-between">
                <span class="text-sm text-gray-600">Attachments:</span>
                <span class="text-sm font-medium text-gray-900"><%= @purchase_request.attachments.count %></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>