// ultimate_turbo_modal@2.2.1 downloaded from https://ga.jspm.io/npm:ultimate_turbo_modal@2.2.1/dist/ultimate_turbo_modal.min.js

import{Controller as e}from"@hotwired/stimulus";async function n(e,n=null){e.classList.remove("hidden"),await r("enter",e,n)}async function o(e,n=null){await r("leave",e,n),e.classList.add("hidden")}async function r(e,n,o){const r=n.dataset,s=o?`${o}-${e}`:e;let l=`transition${e.charAt(0).toUpperCase()+e.slice(1)}`;const u=r[l]?r[l].split(" "):[s],c=r[`${l}Start`]?r[`${l}Start`].split(" "):[`${s}-start`],d=r[`${l}End`]?r[`${l}End`].split(" "):[`${s}-end`];i(n,u),i(n,c),await new Promise((e=>{requestAnimationFrame((()=>{requestAnimationFrame(e)}))})),a(n,c),i(n,d),await function(e){return new Promise((n=>{const o=getComputedStyle(e).transitionDuration.split(",")[0],r=1e3*Number(o.replace("s",""));setTimeout((()=>{n()}),r)}))}
/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/(n),a(n,d),a(n,u)}function i(e,n){e.classList.add(...n)}function a(e,n){e.classList.remove(...n)}var s=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],l=s.join(","),u="undefined"==typeof Element,c=u?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,d=!u&&Element.prototype.getRootNode?function(e){var n;return null==e||null===(n=e.getRootNode)||void 0===n?void 0:n.call(e)}:function(e){return null==e?void 0:e.ownerDocument},f=function e(n,o){var r;void 0===o&&(o=!0);var i=null==n||null===(r=n.getAttribute)||void 0===r?void 0:r.call(n,"inert");return""===i||"true"===i||o&&n&&e(n.parentNode)},h=function(e,n,o){if(f(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(l));return n&&c.call(e,l)&&r.unshift(e),r.filter(o)},v=function e(n,o,r){for(var i=[],a=Array.from(n);a.length;){var s=a.shift();if(!f(s,!1))if("SLOT"===s.tagName){var u=s.assignedElements(),d=e(u.length?u:s.children,!0,r);r.flatten?i.push.apply(i,d):i.push({scopeParent:s,candidates:d})}else{c.call(s,l)&&r.filter(s)&&(o||!n.includes(s))&&i.push(s);var h=s.shadowRoot||"function"==typeof r.getShadowRoot&&r.getShadowRoot(s),v=!f(h,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(s));if(h&&v){var p=e(!0===h?s.children:h.children,!0,r);r.flatten?i.push.apply(i,p):i.push({scopeParent:s,candidates:p})}else a.unshift.apply(a,s.children)}}return i},p=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},m=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||function(e){var n,o=null==e||null===(n=e.getAttribute)||void 0===n?void 0:n.call(e,"contenteditable");return""===o||"true"===o}(e))&&!p(e)?0:e.tabIndex},b=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},y=function(e){return"INPUT"===e.tagName},g=function(e){return function(e){return y(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var n,o=e.form||d(e),r=function(e){return o.querySelectorAll('input[type="radio"][name="'+e+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(e){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",e.message),!1}var i=function(e,n){for(var o=0;o<e.length;o++)if(e[o].checked&&e[o].form===n)return e[o]}(n,e.form);return!i||i===e}(e)},w=function(e){var n=e.getBoundingClientRect(),o=n.width,r=n.height;return 0===o&&0===r},E=function(e,n){var o=n.displayCheck,r=n.getShadowRoot;if("hidden"===getComputedStyle(e).visibility)return!0;var i=c.call(e,"details>summary:first-of-type")?e.parentElement:e;if(c.call(i,"details:not([open]) *"))return!0;if(o&&"full"!==o&&"legacy-full"!==o){if("non-zero-area"===o)return w(e)}else{if("function"==typeof r){for(var a=e;e;){var s=e.parentElement,l=d(e);if(s&&!s.shadowRoot&&!0===r(s))return w(e);e=e.assignedSlot?e.assignedSlot:s||l===e.ownerDocument?s:l.host}e=a}if(function(e){var n,o,r,i,a=e&&d(e),s=null===(n=a)||void 0===n?void 0:n.host,l=!1;if(a&&a!==e)for(l=!!(null!==(o=s)&&void 0!==o&&null!==(r=o.ownerDocument)&&void 0!==r&&r.contains(s)||null!=e&&null!==(i=e.ownerDocument)&&void 0!==i&&i.contains(e));!l&&s;){var u,c,f;l=!(null===(c=s=null===(u=a=d(s))||void 0===u?void 0:u.host)||void 0===c||null===(f=c.ownerDocument)||void 0===f||!f.contains(s))}return l}(e))return!e.getClientRects().length;if("legacy-full"!==o)return!0}return!1},S=function(e,n){return!(n.disabled||f(n)||function(e){return y(e)&&"hidden"===e.type}(n)||E(n,e)||function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some((function(e){return"SUMMARY"===e.tagName}))}(n)||function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if("FIELDSET"===n.tagName&&n.disabled){for(var o=0;o<n.children.length;o++){var r=n.children.item(o);if("LEGEND"===r.tagName)return!!c.call(n,"fieldset[disabled] *")||!r.contains(e)}return!0}n=n.parentElement}return!1}(n))},N=function(e,n){return!(g(n)||m(n)<0||!S(e,n))},T=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},A=function e(n){var o=[],r=[];return n.forEach((function(n,i){var a=!!n.scopeParent,s=a?n.scopeParent:n,l=function(e,n){var o=m(e);return o<0&&n&&!p(e)?0:o}(s,a),u=a?e(n.candidates):s;0===l?a?o.push.apply(o,u):o.push(s):r.push({documentOrder:i,tabIndex:l,item:n,isScope:a,content:u})})),r.sort(b).reduce((function(e,n){return n.isScope?e.push.apply(e,n.content):e.push(n.content),e}),[]).concat(o)},k=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return!1!==c.call(e,l)&&N(n,e)},P=s.concat("iframe").join(","),O=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return!1!==c.call(e,P)&&S(n,e)};
/*!
* focus-trap 7.6.5
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function M(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,r=Array(n);o<n;o++)r[o]=e[o];return r}function F(e,n,o){return(n=function(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,n);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function x(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,r)}return o}function L(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?x(Object(o),!0).forEach((function(n){F(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):x(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function R(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return M(e,n);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?M(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var I=function(e,n){if(e.length>0){var o=e[e.length-1];o!==n&&o._setPausedState(!0)}var r=e.indexOf(n);-1===r||e.splice(r,1),e.push(n)},C=function(e,n){var o=e.indexOf(n);-1!==o&&e.splice(o,1),e.length>0&&!e[e.length-1]._isManuallyPaused()&&e[e.length-1]._setPausedState(!1)},D=function(e){return"Tab"===(null==e?void 0:e.key)||9===(null==e?void 0:e.keyCode)},B=function(e){return D(e)&&!e.shiftKey},H=function(e){return D(e)&&e.shiftKey},j=function(e){return setTimeout(e,0)},G=function(e){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];return"function"==typeof e?e.apply(void 0,o):e},V=function(e){return e.target.shadowRoot&&"function"==typeof e.composedPath?e.composedPath()[0]:e.target},$=[],U=function(e,n){var o,r=(null==n?void 0:n.document)||document,i=(null==n?void 0:n.trapStack)||$,a=L({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:B,isKeyBackward:H},n),s={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},l=function(e,n,o){return e&&void 0!==e[n]?e[n]:a[o||n]},u=function(e,n){var o="function"==typeof(null==n?void 0:n.composedPath)?n.composedPath():void 0;return s.containerGroups.findIndex((function(n){var r=n.container,i=n.tabbableNodes;return r.contains(e)||(null==o?void 0:o.includes(r))||i.find((function(n){return n===e}))}))},c=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.hasFallback,i=void 0!==o&&o,s=n.params,l=void 0===s?[]:s,u=a[e];if("function"==typeof u&&(u=u.apply(void 0,R(l))),!0===u&&(u=void 0),!u){if(void 0===u||!1===u)return u;throw new Error("`".concat(e,"` was specified but was not a node, or did not return a node"))}var c=u;if("string"==typeof u){try{c=r.querySelector(u)}catch(n){throw new Error("`".concat(e,'` appears to be an invalid selector; error="').concat(n.message,'"'))}if(!c&&!i)throw new Error("`".concat(e,"` as selector refers to no known node"))}return c},d=function(){var e=c("initialFocus",{hasFallback:!0});if(!1===e)return!1;if(void 0===e||e&&!O(e,a.tabbableOptions))if(u(r.activeElement)>=0)e=r.activeElement;else{var n=s.tabbableGroups[0];e=n&&n.firstTabbableNode||c("fallbackFocus")}else null===e&&(e=c("fallbackFocus"));if(!e)throw new Error("Your focus-trap needs to have at least one focusable element");return e},f=function(){if(s.containerGroups=s.containers.map((function(e){var n=function(e,n){var o;return o=(n=n||{}).getShadowRoot?v([e],n.includeContainer,{filter:N.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:T}):h(e,n.includeContainer,N.bind(null,n)),A(o)}(e,a.tabbableOptions),o=function(e,n){return(n=n||{}).getShadowRoot?v([e],n.includeContainer,{filter:S.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):h(e,n.includeContainer,S.bind(null,n))}(e,a.tabbableOptions),r=n.length>0?n[0]:void 0,i=n.length>0?n[n.length-1]:void 0,s=o.find((function(e){return k(e)})),l=o.slice().reverse().find((function(e){return k(e)})),u=!!n.find((function(e){return m(e)>0}));return{container:e,tabbableNodes:n,focusableNodes:o,posTabIndexesFound:u,firstTabbableNode:r,lastTabbableNode:i,firstDomTabbableNode:s,lastDomTabbableNode:l,nextTabbableNode:function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=n.indexOf(e);return i<0?r?o.slice(o.indexOf(e)+1).find((function(e){return k(e)})):o.slice(0,o.indexOf(e)).reverse().find((function(e){return k(e)})):n[i+(r?1:-1)]}}})),s.tabbableGroups=s.containerGroups.filter((function(e){return e.tabbableNodes.length>0})),s.tabbableGroups.length<=0&&!c("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(s.containerGroups.find((function(e){return e.posTabIndexesFound}))&&s.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},p=function(e){var n=e.activeElement;if(n)return n.shadowRoot&&null!==n.shadowRoot.activeElement?p(n.shadowRoot):n},b=function(e){!1!==e&&e!==p(document)&&(e&&e.focus?(e.focus({preventScroll:!!a.preventScroll}),s.mostRecentlyFocusedNode=e,function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select}(e)&&e.select()):b(d()))},y=function(e){var n=c("setReturnFocus",{params:[e]});return n||!1!==n&&e},g=function(e){var n=e.target,o=e.event,r=e.isBackward,i=void 0!==r&&r;n=n||V(o),f();var l=null;if(s.tabbableGroups.length>0){var d=u(n,o),h=d>=0?s.containerGroups[d]:void 0;if(d<0)l=i?s.tabbableGroups[s.tabbableGroups.length-1].lastTabbableNode:s.tabbableGroups[0].firstTabbableNode;else if(i){var v=s.tabbableGroups.findIndex((function(e){var o=e.firstTabbableNode;return n===o}));if(v<0&&(h.container===n||O(n,a.tabbableOptions)&&!k(n,a.tabbableOptions)&&!h.nextTabbableNode(n,!1))&&(v=d),v>=0){var p=0===v?s.tabbableGroups.length-1:v-1,b=s.tabbableGroups[p];l=m(n)>=0?b.lastTabbableNode:b.lastDomTabbableNode}else D(o)||(l=h.nextTabbableNode(n,!1))}else{var y=s.tabbableGroups.findIndex((function(e){var o=e.lastTabbableNode;return n===o}));if(y<0&&(h.container===n||O(n,a.tabbableOptions)&&!k(n,a.tabbableOptions)&&!h.nextTabbableNode(n))&&(y=d),y>=0){var g=y===s.tabbableGroups.length-1?0:y+1,w=s.tabbableGroups[g];l=m(n)>=0?w.firstTabbableNode:w.firstDomTabbableNode}else D(o)||(l=h.nextTabbableNode(n))}}else l=c("fallbackFocus");return l},w=function(e){var n=V(e);u(n,e)>=0||(G(a.clickOutsideDeactivates,e)?o.deactivate({returnFocus:a.returnFocusOnDeactivate}):G(a.allowOutsideClick,e)||e.preventDefault())},E=function(e){var n=V(e),o=u(n,e)>=0;if(o||n instanceof Document)o&&(s.mostRecentlyFocusedNode=n);else{var r;e.stopImmediatePropagation();var i=!0;if(s.mostRecentlyFocusedNode)if(m(s.mostRecentlyFocusedNode)>0){var l=u(s.mostRecentlyFocusedNode),c=s.containerGroups[l].tabbableNodes;if(c.length>0){var f=c.findIndex((function(e){return e===s.mostRecentlyFocusedNode}));f>=0&&(a.isKeyForward(s.recentNavEvent)?f+1<c.length&&(r=c[f+1],i=!1):f-1>=0&&(r=c[f-1],i=!1))}}else s.containerGroups.some((function(e){return e.tabbableNodes.some((function(e){return m(e)>0}))}))||(i=!1);else i=!1;i&&(r=g({target:s.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(s.recentNavEvent)})),b(r||s.mostRecentlyFocusedNode||d())}s.recentNavEvent=void 0},P=function(e){(a.isKeyForward(e)||a.isKeyBackward(e))&&function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s.recentNavEvent=e;var o=g({event:e,isBackward:n});o&&(D(e)&&e.preventDefault(),b(o))}(e,a.isKeyBackward(e))},M=function(e){var n;"Escape"!==(null==(n=e)?void 0:n.key)&&"Esc"!==(null==n?void 0:n.key)&&27!==(null==n?void 0:n.keyCode)||!1===G(a.escapeDeactivates,e)||(e.preventDefault(),o.deactivate())},F=function(e){var n=V(e);u(n,e)>=0||G(a.clickOutsideDeactivates,e)||G(a.allowOutsideClick,e)||(e.preventDefault(),e.stopImmediatePropagation())},x=function(){if(s.active)return I(i,o),s.delayInitialFocusTimer=a.delayInitialFocus?j((function(){b(d())})):b(d()),r.addEventListener("focusin",E,!0),r.addEventListener("mousedown",w,{capture:!0,passive:!1}),r.addEventListener("touchstart",w,{capture:!0,passive:!1}),r.addEventListener("click",F,{capture:!0,passive:!1}),r.addEventListener("keydown",P,{capture:!0,passive:!1}),r.addEventListener("keydown",M),o},U=function(){if(s.active)return r.removeEventListener("focusin",E,!0),r.removeEventListener("mousedown",w,!0),r.removeEventListener("touchstart",w,!0),r.removeEventListener("click",F,!0),r.removeEventListener("keydown",P,!0),r.removeEventListener("keydown",M),o},_="undefined"!=typeof window&&"MutationObserver"in window?new MutationObserver((function(e){e.some((function(e){return Array.from(e.removedNodes).some((function(e){return e===s.mostRecentlyFocusedNode}))}))&&b(d())})):void 0,K=function(){_&&(_.disconnect(),s.active&&!s.paused&&s.containers.map((function(e){_.observe(e,{subtree:!0,childList:!0})})))};return o={get active(){return s.active},get paused(){return s.paused},activate:function(e){if(s.active)return this;var n=l(e,"onActivate"),o=l(e,"onPostActivate"),i=l(e,"checkCanFocusTrap");i||f(),s.active=!0,s.paused=!1,s.nodeFocusedBeforeActivation=p(r),null==n||n();var a=function(){i&&f(),x(),K(),null==o||o()};return i?(i(s.containers.concat()).then(a,a),this):(a(),this)},deactivate:function(e){if(!s.active)return this;var n=L({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},e);clearTimeout(s.delayInitialFocusTimer),s.delayInitialFocusTimer=void 0,U(),s.active=!1,s.paused=!1,K(),C(i,o);var r=l(n,"onDeactivate"),u=l(n,"onPostDeactivate"),c=l(n,"checkCanReturnFocus"),d=l(n,"returnFocus","returnFocusOnDeactivate");null==r||r();var f=function(){j((function(){d&&b(y(s.nodeFocusedBeforeActivation)),null==u||u()}))};return d&&c?(c(y(s.nodeFocusedBeforeActivation)).then(f,f),this):(f(),this)},pause:function(e){return s.active?(s.manuallyPaused=!0,this._setPausedState(!0,e)):this},unpause:function(e){return s.active?(s.manuallyPaused=!1,i[i.length-1]!==this?this:this._setPausedState(!1,e)):this},updateContainerElements:function(e){var n=[].concat(e).filter(Boolean);return s.containers=n.map((function(e){return"string"==typeof e?r.querySelector(e):e})),s.active&&f(),K(),this}},Object.defineProperties(o,{_isManuallyPaused:{value:function(){return s.manuallyPaused}},_setPausedState:{value:function(e,n){if(s.paused===e)return this;if(s.paused=e,e){var o=l(n,"onPause"),r=l(n,"onPostPause");null==o||o(),U(),K(),null==r||r()}else{var i=l(n,"onUnpause"),a=l(n,"onPostUnpause");null==i||i(),f(),x(),K(),null==a||a()}return this}}}),o.updateContainerElements(e),o};const _="2.2.1";class q extends e{static targets=["container","content","overlay","outer"];static values={advanceUrl:String,allowedClickOutsideSelector:String};connect(){let e=this;this.#e(),this.focusTrapInstance=null,this.originalBodyOverflow=null,this.scrollPosition=0,this.showModal(),this.turboFrame=this.element.closest("turbo-frame"),window.addEventListener("popstate",(function(n){e.#t()&&e.#n()})),window.modal=this}disconnect(){this.focusTrapInstance&&this.#o(),window.modal=void 0}showModal(){this.#r(),Promise.all([n(this.overlayTarget),n(this.outerTarget)]).then((()=>{this.#i()})),this.advanceUrlValue&&!this.#t()&&(this.#a(),history.pushState({},"",this.advanceUrlValue))}hideModal(){if(this.hidingModal)return;this.hidingModal=!0;let e=new Event("modal:closing",{cancelable:!0});this.turboFrame.dispatchEvent(e),e.defaultPrevented?this.hidingModal=!1:(this.focusTrapInstance&&this.#o(),this.#n(),e=new Event("modal:closed",{cancelable:!1}),this.turboFrame.dispatchEvent(e),this.#t()&&history.back())}hide(){this.hideModal()}refreshPage(){window.Turbo.visit(window.location.href,{action:"replace"})}submitEnd(e){e.detail.success&&this.hideModal()}closeWithKeyboard(e){"Escape"==e.code&&this.hideModal()}outsideModalClicked(e){let n=!document.contains(e.target)||this.contentTarget.contains(e.target)||this.contentTarget==e.target,o=this.allowedClickOutsideSelectorValue&&""!==this.allowedClickOutsideSelectorValue&&null!=e.target.closest(this.allowedClickOutsideSelectorValue);n||o||this.hideModal()}#n(){this.#s(),Promise.all([o(this.overlayTarget),o(this.outerTarget)]).then((()=>{this.turboFrame.removeAttribute("src"),this.containerTarget.remove(),this.#l()}))}#t(){return"true"==document.body.getAttribute("data-turbo-modal-history-advanced")}#a(){return document.body.setAttribute("data-turbo-modal-history-advanced","true")}#l(){document.body.removeAttribute("data-turbo-modal-history-advanced")}#e(){const e=this.element.dataset.utmrVersion;e&&e!==_&&console.warn(`[UltimateTurboModal] Version Mismatch!\n\nGem Version: ${e}\nJS Version:  ${_}\n\nPlease ensure both the 'ultimate_turbo_modal' gem and the 'ultimate-turbo-modal' npm package are updated to the same version.\nElement:`,this.element)}#i(){try{this.focusTrapInstance||(this.focusTrapInstance=U(this.contentTarget,{allowOutsideClick:!0,escapeDeactivates:!1,fallbackFocus:this.contentTarget,returnFocusOnDeactivate:!0,clickOutsideDeactivates:!1,preventScroll:!1,initialFocus:()=>this.contentTarget.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')||this.contentTarget})),this.focusTrapInstance.activate()}catch(e){console.error("[UltimateTurboModal] Failed to activate focus trap:",e),this.focusTrapInstance=null}}#o(){try{this.focusTrapInstance&&this.focusTrapInstance.active&&this.focusTrapInstance.deactivate()}catch(e){console.error("[UltimateTurboModal] Failed to deactivate focus trap:",e)}finally{this.focusTrapInstance=null}}#r(){this.scrollPosition=window.pageYOffset||document.documentElement.scrollTop,this.originalBodyOverflow=document.body.style.overflow,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${this.scrollPosition}px`,document.body.style.width="100%"}#s(){null!==this.originalBodyOverflow?document.body.style.overflow=this.originalBodyOverflow:document.body.style.removeProperty("overflow"),document.body.style.removeProperty("position"),document.body.style.removeProperty("top"),document.body.style.removeProperty("width"),window.scrollTo(0,this.scrollPosition)}}var K=function(){const e=()=>{},n={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:e,afterNodeAdded:e,beforeNodeMorphed:e,afterNodeMorphed:e,beforeNodeRemoved:e,afterNodeRemoved:e,beforeAttributeUpdated:e},head:{style:"merge",shouldPreserve:e=>"true"===e.getAttribute("im-preserve"),shouldReAppend:e=>"true"===e.getAttribute("im-re-append"),shouldRemove:e,afterHeadMorphed:e},restoreFocus:!0};const o=function(){function e(e,n,o,i){if(!1===i.callbacks.beforeNodeAdded(n))return null;if(i.idMap.has(n)){const a=document.createElement(n.tagName);return e.insertBefore(a,o),r(a,n,i),i.callbacks.afterNodeAdded(a),a}{const r=document.importNode(n,!0);return e.insertBefore(r,o),i.callbacks.afterNodeAdded(r),r}}const n=function(){function e(e,n,o){let r=e.idMap.get(n),i=e.idMap.get(o);if(!i||!r)return!1;for(const e of r)if(i.has(e))return!0;return!1}function n(e,n){const o=e,r=n;return o.nodeType===r.nodeType&&o.tagName===r.tagName&&(!o.id||o.id===r.id)}return function(o,r,i,a){let s=null,l=r.nextSibling,u=0,c=i;for(;c&&c!=a;){if(n(c,r)){if(e(o,c,r))return c;null===s&&(o.idMap.has(c)||(s=c))}if(null===s&&l&&n(c,l)&&(u++,l=l.nextSibling,u>=2&&(s=void 0)),c.contains(document.activeElement))break;c=c.nextSibling}return s||null}}();function o(e,n){if(e.idMap.has(n))s(e.pantry,n,null);else{if(!1===e.callbacks.beforeNodeRemoved(n))return;n.parentNode?.removeChild(n),e.callbacks.afterNodeRemoved(n)}}function i(e,n,r){let i=n;for(;i&&i!==r;){let n=i;i=i.nextSibling,o(e,n)}return i}function a(e,n,o,r){const i=r.target.id===n&&r.target||r.target.querySelector(`[id="${n}"]`)||r.pantry.querySelector(`[id="${n}"]`);return function(e,n){const o=e.id;for(;e=e.parentNode;){let r=n.idMap.get(e);r&&(r.delete(o),r.size||n.idMap.delete(e))}}(i,r),s(e,i,o),i}function s(e,n,o){if(e.moveBefore)try{e.moveBefore(n,o)}catch(r){e.insertBefore(n,o)}else e.insertBefore(n,o)}return function(s,l,u,c=null,d=null){l instanceof HTMLTemplateElement&&u instanceof HTMLTemplateElement&&(l=l.content,u=u.content),c||=l.firstChild;for(const o of u.childNodes){if(c&&c!=d){const e=n(s,o,c,d);if(e){e!==c&&i(s,c,e),r(e,o,s),c=e.nextSibling;continue}}if(o instanceof Element&&s.persistentIds.has(o.id)){const e=a(l,o.id,c,s);r(e,o,s),c=e.nextSibling;continue}const u=e(l,o,c,s);u&&(c=u.nextSibling)}for(;c&&c!=d;){const e=c;c=c.nextSibling,o(s,e)}}}(),r=function(){function e(e,o,r,i){const a=o[r];if(a!==e[r]){const s=n(r,e,"update",i);s||(e[r]=o[r]),a?s||e.setAttribute(r,""):n(r,e,"remove",i)||e.removeAttribute(r)}}function n(e,n,o,r){return!("value"!==e||!r.ignoreActiveValue||n!==document.activeElement)||!1===r.callbacks.beforeAttributeUpdated(e,n,o)}function r(e,n){return!!n.ignoreActiveValue&&e===document.activeElement&&e!==document.body}return function(a,s,l){return l.ignoreActive&&a===document.activeElement?null:(!1===l.callbacks.beforeNodeMorphed(a,s)||(a instanceof HTMLHeadElement&&l.head.ignore||(a instanceof HTMLHeadElement&&"morph"!==l.head.style?i(a,s,l):(!function(o,i,a){let s=i.nodeType;if(1===s){const s=o,l=i,u=s.attributes,c=l.attributes;for(const e of c)n(e.name,s,"update",a)||s.getAttribute(e.name)!==e.value&&s.setAttribute(e.name,e.value);for(let e=u.length-1;0<=e;e--){const o=u[e];if(o&&!l.hasAttribute(o.name)){if(n(o.name,s,"remove",a))continue;s.removeAttribute(o.name)}}r(s,a)||function(o,r,i){if(o instanceof HTMLInputElement&&r instanceof HTMLInputElement&&"file"!==r.type){let a=r.value,s=o.value;e(o,r,"checked",i),e(o,r,"disabled",i),r.hasAttribute("value")?s!==a&&(n("value",o,"update",i)||(o.setAttribute("value",a),o.value=a)):n("value",o,"remove",i)||(o.value="",o.removeAttribute("value"))}else if(o instanceof HTMLOptionElement&&r instanceof HTMLOptionElement)e(o,r,"selected",i);else if(o instanceof HTMLTextAreaElement&&r instanceof HTMLTextAreaElement){let e=r.value,a=o.value;if(n("value",o,"update",i))return;e!==a&&(o.value=e),o.firstChild&&o.firstChild.nodeValue!==e&&(o.firstChild.nodeValue=e)}}(s,l,a)}8!==s&&3!==s||o.nodeValue!==i.nodeValue&&(o.nodeValue=i.nodeValue)}(a,s,l),r(a,l)||o(l,a,s))),l.callbacks.afterNodeMorphed(a,s)),a)}}();function i(e,n,o){let r=[],i=[],a=[],s=[],l=new Map;for(const e of n.children)l.set(e.outerHTML,e);for(const n of e.children){let e=l.has(n.outerHTML),r=o.head.shouldReAppend(n),u=o.head.shouldPreserve(n);e||u?r?i.push(n):(l.delete(n.outerHTML),a.push(n)):"append"===o.head.style?r&&(i.push(n),s.push(n)):!1!==o.head.shouldRemove(n)&&i.push(n)}s.push(...l.values());let u=[];for(const n of s){let i=document.createRange().createContextualFragment(n.outerHTML).firstChild;if(!1!==o.callbacks.beforeNodeAdded(i)){if("href"in i&&i.href||"src"in i&&i.src){let e,n=new Promise((function(n){e=n}));i.addEventListener("load",(function(){e()})),u.push(n)}e.appendChild(i),o.callbacks.afterNodeAdded(i),r.push(i)}}for(const n of i)!1!==o.callbacks.beforeNodeRemoved(n)&&(e.removeChild(n),o.callbacks.afterNodeRemoved(n));return o.head.afterHeadMorphed(e,{added:r,kept:a,removed:i}),u}const a=function(){function e(){const e=document.createElement("div");return e.hidden=!0,document.body.insertAdjacentElement("afterend",e),e}function o(e){let n=Array.from(e.querySelectorAll("[id]"));return e.id&&n.push(e),n}function r(e,n,o,r){for(const i of r)if(n.has(i.id)){let n=i;for(;n;){let r=e.get(n);if(null==r&&(r=new Set,e.set(n,r)),r.add(i.id),n===o)break;n=n.parentElement}}}return function(i,a,s){const{persistentIds:l,idMap:u}=function(e,n){const i=o(e),a=o(n),s=function(e,n){let o=new Set,r=new Map;for(const{id:n,tagName:i}of e)r.has(n)?o.add(n):r.set(n,i);let i=new Set;for(const{id:e,tagName:a}of n)i.has(e)?o.add(e):r.get(e)===a&&i.add(e);for(const e of o)i.delete(e);return i}(i,a);let l=new Map;r(l,s,e,i);const u=n.__idiomorphRoot||n;return r(l,s,u,a),{persistentIds:s,idMap:l}}(i,a),c=function(e){let o=Object.assign({},n);return Object.assign(o,e),o.callbacks=Object.assign({},n.callbacks,e.callbacks),o.head=Object.assign({},n.head,e.head),o}(s),d=c.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(d))throw`Do not understand how to morph style ${d}`;return{target:i,newContent:a,config:c,morphStyle:d,ignoreActive:c.ignoreActive,ignoreActiveValue:c.ignoreActiveValue,restoreFocus:c.restoreFocus,idMap:u,persistentIds:l,pantry:e(),callbacks:c.callbacks,head:c.head}}}(),{normalizeElement:s,normalizeParent:l}=function(){const e=new WeakSet;class t{constructor(e){this.originalNode=e,this.realParentNode=e.parentNode,this.previousSibling=e.previousSibling,this.nextSibling=e.nextSibling}get childNodes(){const e=[];let n=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;n&&n!=this.nextSibling;)e.push(n),n=n.nextSibling;return e}querySelectorAll(e){return this.childNodes.reduce(((n,o)=>{if(o instanceof Element){o.matches(e)&&n.push(o);const r=o.querySelectorAll(e);for(let e=0;e<r.length;e++)n.push(r[e])}return n}),[])}insertBefore(e,n){return this.realParentNode.insertBefore(e,n)}moveBefore(e,n){return this.realParentNode.moveBefore(e,n)}get __idiomorphRoot(){return this.originalNode}}return{normalizeElement:function(e){return e instanceof Document?e.documentElement:e},normalizeParent:function n(o){if(null==o)return document.createElement("div");if("string"==typeof o)return n(function(n){let o=new DOMParser,r=n.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(r.match(/<\/html>/)||r.match(/<\/head>/)||r.match(/<\/body>/)){let i=o.parseFromString(n,"text/html");if(r.match(/<\/html>/))return e.add(i),i;{let n=i.firstChild;return n&&e.add(n),n}}{let r=o.parseFromString("<body><template>"+n+"</template></body>","text/html").body.querySelector("template").content;return e.add(r),r}}(o));if(e.has(o))return o;if(o instanceof Node){if(o.parentNode)return new t(o);{const e=document.createElement("div");return e.append(o),e}}{const e=document.createElement("div");for(const n of[...o])e.append(n);return e}}}}();return{morph:function(e,n,r={}){e=s(e);const u=l(n),c=a(e,u,r),d=function(e,n){if(!e.config.restoreFocus)return n();let o=document.activeElement;if(!(o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement))return n();const{id:r,selectionStart:i,selectionEnd:a}=o,s=n();r&&r!==document.activeElement?.id&&(o=e.target.querySelector(`[id="${r}"]`),o?.focus());o&&!o.selectionEnd&&a&&o.setSelectionRange(i,a);return s}(c,(()=>function(e,n,o,r){if(e.head.block){const a=n.querySelector("head"),s=o.querySelector("head");if(a&&s){const n=i(a,s,e);return Promise.all(n).then((()=>{const n=Object.assign(e,{head:{block:!1,ignore:!0}});return r(n)}))}}return r(e)}(c,e,u,(n=>"innerHTML"===n.morphStyle?(o(n,e,u),Array.from(e.childNodes)):function(e,n,r){const i=l(n);return o(e,i,r,n,n.nextSibling),Array.from(i.childNodes)}(n,e,u)))));return c.pantry.remove(),d},defaults:n}}();Turbo.StreamActions.modal=function(){const e=this.getAttribute("message");"hide"==e&&window.modal?.hide(),"close"==e&&window.modal?.hide()};const z=e=>{const n=e?.target;return n instanceof Element&&"turbo-frame"===n.tagName.toLowerCase()&&("modal"===n.id||"modal-inner"===n.id)},Y=e=>{e.detail.response.redirected&&z(e)&&(e.preventDefault(),e.detail.visit(e.detail.response))},W=e=>{z(e)&&(e.detail.render=(e,n)=>{K.morph(e,n,{morphstyle:"innerHTML"})})};document.removeEventListener("turbo:frame-missing",Y),document.addEventListener("turbo:frame-missing",Y),document.removeEventListener("turbo:before-frame-render",W),document.addEventListener("turbo:before-frame-render",W);export{q as UltimateTurboModalController};

